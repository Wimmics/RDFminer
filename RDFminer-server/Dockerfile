FROM node:18
# define env var
ARG RDFMINER_SERVER_PORT
ARG RDFMINER_SERVER_MONGODB_PORT
ARG RDFMINER_SERVER_MONGODB_CONNECTION
ARG RDFMINER_SERVER_AUTH_KEY
ARG RDFMINER_SERVER_MONGODB_DATAPATH
ARG RDFMINER_SERVER_REDIS_PORT
ARG RDFMINER_SERVER_WS
#
ENV APP=/app
ENV RDFMINER_SERVER_PORT=$RDFMINER_SERVER_PORT
ENV RDFMINER_SERVER_MONGODB_PORT=$RDFMINER_SERVER_MONGODB_PORT
ENV RDFMINER_SERVER_MONGODB_CONNECTION=$RDFMINER_SERVER_MONGODB_CONNECTION
ENV RDFMINER_SERVER_AUTH_KEY=$RDFMINER_SERVER_AUTH_KEY
ENV RDFMINER_SERVER_MONGODB_DATAPATH=$RDFMINER_SERVER_MONGODB_DATAPATH
ENV RDFMINER_SERVER_REDIS_PORT=$RDFMINER_SERVER_REDIS_PORT
ENV RDFMINER_SERVER_WS=$RDFMINER_SERVER_WS
# 
RUN mkdir $APP
WORKDIR $APP
# install redis client
RUN apt-get update && apt-get install redis -y
# installing dependencies
COPY package*.json $APP/
# install
RUN npm install
#
COPY settings.json $APP/
COPY swagger.js $APP/
COPY app.js $APP/
# create a .env file for NodeJS
COPY setup_env.sh $APP/
RUN chmod +x $APP/setup_env.sh
ENV ENVIRONMENT_FOR_NODE=$APP/.env
RUN ./setup_env.sh
# copy code
COPY ./auth $APP/auth/
COPY ./docker $APP/docker/
COPY ./logs $APP/logs/
COPY ./model $APP/model/
COPY ./servers $APP/servers/
COPY ./services $APP/services/
COPY ./tools $APP/tools/
# end
CMD ["node", "app.js"]